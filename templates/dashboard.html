<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Cinema Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  </head>
  <body>
    <div class="container">
      <div class="header-container">
        <div class="header-border">
          <h2 class="header-title">
            CineMetrics – Data-Driven Cinema Insights
          </h2>
        </div>
      </div>

      <div class="chart-grid">
        <div class="chart-container">
          <div class="chart-header">
            <h3 class="chart-title">Number of Movies Produced By Country</h3>
            <button class="info-button" onclick="showInfoDialog(
              'Information', 
              'This choropleth map shows the number of movies produced by each country found on the October, 2024 version of ' +
              '<a href=\'https://www.kaggle.com/datasets/alanvourch/tmdb-movies-daily-updates\' target=\'_blank\'>The Ultimate 1Million Movies Dataset (TMDB + IMDb)</a>.' +
              '<br><br> Countries with no known data are displayed as gray.'
            )">i</button>
          </div>
          <div class="chart-content">
            {{ choropleth_chart | safe }}
          </div>
        </div>

        <div class="chart-container">
          <div class="chart-header">
            <h3 class="chart-title">Number of Movies Produced By Year</h3>
            <button class="info-button" onclick="showInfoDialog(
              'Information', 
              'This is the dialog for chart 2'
            )">i</button>
          </div>

          <div class="controls-container">
            <div class="select-container">
              <label for="categorySelector">
                Select a category:
              </label>

              <select id="categorySelector" class="select-field">
                {% for category in category_options %}
                <option value="{{ category }}" >
                  {{ category }}
                </option>
                {% endfor %}
              </select>
            </div>
            <div class="select-container">
              <label for="optionSelector">
                Select an option:
              </label>

              <select id="optionSelector" class="select-field">
              </select>
            </div>
          </div>
          <div class="chart-content">
            {{ releases_chart | safe }}
          </div>
        </div>

        <div class="chart-container">
          {{ waffle_chart | safe }}
        </div>

        <div class="chart-container">
          {{ revenue_budget_line_chart | safe }}
        </div>

        <div class="chart-container">
          <div class="chart-header">
            <h3 class="chart-title">Top 10 Rankings</h3>
            <button class="info-button" onclick="showInfoDialog(
              'Information', 
              'Choose between the top 10 actors, writers, or directors ranked by number of movies.'
            )">i</button>
          </div>

          <div class="controls-container">
            <div class="select-container">
              <label for="categorySelect">
                Ver ranking de:
              </label>
              <select id="categorySelect" class="select-field">
                <option value="actors">Actores</option>
                <option value="writers">Escritores</option>
                <option value="directors">Directores</option>
              </select>
            </div>
          </div>

          <div class="chart-content">
            <div id="chartActors">
              {{ actors_bar_chart | safe }}
            </div>
            <div id="chartWriters" style="display:none;">
              {{ writers_bar_chart | safe }}
            </div>
            <div id="chartDirectors" style="display:none;">
              {{ directors_bar_chart | safe }}
            </div>
          </div>
        </div>

        <div class="chart-container">
          <div class="chart-header">
            <h3 class="chart-title">Wordcloud by Genre</h3>
            <label for="genreWordSelect">Select Genre:</label>
            <!-- 1

            -->
            <button class="info-button" onclick="showInfoDialog(
              'Information', 
              'These wordclouds show the most common words in movie overviews for the selected genre.'
            )">i</button>
          </div>
          <div class="chart-content">
            <!-- 2

            -->
          </div>
        </div>


    <div id="infoDialog" class="dialog-overlay">
      <div class="dialog-content">
        <button class="close-button" onclick="hideInfoDialog()">&times;</button>
        <h2 id="dialogTitle" class="dialog-title">Title</h2>
        <div id="dialogMessage" class="dialog-message">Message goes here</div>
      </div>
    </div>

    <script>
      function showInfoDialog(title, message) {
        document.getElementById('dialogTitle').textContent = title;
        document.getElementById('dialogMessage').innerHTML = message;
        document.getElementById('infoDialog').style.display = 'flex';
      }
      
      function hideInfoDialog() {
        document.getElementById('infoDialog').style.display = 'none';
      }

      document.getElementById('infoDialog').addEventListener('click', function(e) {
        if (e.target === this) hideInfoDialog();
      });

      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') hideInfoDialog();
      });

    </script>

    <script>
      // Selector de categoría para el gráfico de barras, evita tener que recargar la página
      document.getElementById('categorySelect').addEventListener('change', function() {
        document.getElementById('chartActors').style.display = 'none';
        document.getElementById('chartWriters').style.display = 'none';
        document.getElementById('chartDirectors').style.display = 'none';

        const value = this.value;
        if (value === 'actors') {
          document.getElementById('chartActors').style.display = 'block';
        } else if (value === 'writers') {
          document.getElementById('chartWriters').style.display = 'block';
        } else if (value === 'directors') {
          document.getElementById('chartDirectors').style.display = 'block';
        }
      });

      // Selector de género para wordcloud, lo mismo que el de barras, evita recargar la página
      /*
      document.getElementById('genreWordSelect').addEventListener('change', function() {
        const allClouds = document.getElementsByClassName('wordcloud-image');
        for (let i = 0; i < allClouds.length; i++) {
          allClouds[i].style.display = 'none';
        }
        const selected = this.value;
        document.getElementById('wordcloud-' + selected).style.display = 'block';
      });
      */
    </script>

    <script>
      /* Ignore the syntax error marked by VS Code */
      const categoryValues = {{ category_values | tojson | safe }};
    </script>

    <script>
      const categorySelector = document.getElementById('categorySelector');
      const optionSelector = document.getElementById('optionSelector');

      function populateOptionSelector(category) {
        optionSelector.innerHTML = "";
        const options = categoryValues[category] || ['---'];

        options.forEach(option => {
          const opt = document.createElement('option');
          opt.value = option;
          opt.textContent = option;
          optionSelector.appendChild(opt);
        });
      }

      populateOptionSelector(categorySelector.value);

      categorySelector.addEventListener('change', function () {
        populateOptionSelector(this.value)
      });
    </script>

  </body>
</html>
